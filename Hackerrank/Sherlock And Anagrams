from collections import defaultdict

def sherlockAndAnagrams(s):
    freq_map = defaultdict(int)
    n = len(s)

    # Generate all substrings
    for i in range(n):
        for j in range(i+1, n+1):
            sub = ''.join(sorted(s[i:j]))
            freq_map[sub] += 1

    # Count pairs
    count = 0
    for f in freq_map.values():
        count += f * (f - 1) // 2

    return count
